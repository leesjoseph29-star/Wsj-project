<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order Manager Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body { font-family:'Segoe UI',sans-serif; background:#f5f7fa; padding:30px; }
h1 { margin-bottom:20px; }

.dashboard {
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:20px;
margin-bottom:30px;
}

.card {
background:white;
padding:20px;
border-radius:10px;
box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

.card h2 { margin:0; font-size:16px; color:#555; }
.card p { font-size:24px; font-weight:bold; margin-top:10px; }

.progress-container {
background:#e0e6ed;
border-radius:20px;
height:20px;
overflow:hidden;
margin-top:10px;
}
.progress-bar {
height:100%;
width:0%;
background:linear-gradient(90deg,#4a6cf7,#7a8df7);
transition:0.4s;
}

.controls { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:20px; }

input,select,button {
padding:8px 12px;
border-radius:6px;
border:1px solid #ccc;
}

button {
background:#4a6cf7;
color:white;
border:none;
cursor:pointer;
}
button:hover { background:#3b58c7; }

.delete-btn {
background:#e74c3c;
}
.delete-btn:hover {
background:#c0392b;
}

table {
width:100%;
border-collapse:collapse;
background:white;
box-shadow:0 4px 12px rgba(0,0,0,0.08);
margin-bottom:30px;
}
th,td { padding:12px; text-align:center; }
th { background:#4a6cf7; color:white; }
tr:nth-child(even) { background:#f9fbff; }

.form-section,.chart-section {
background:white;
padding:20px;
border-radius:10px;
box-shadow:0 4px 12px rgba(0,0,0,0.08);
margin-bottom:30px;
}

canvas { height:300px !important; }
</style>
</head>
<body>

<h1>Business Order Dashboard</h1>

<div class="dashboard">
<div class="card">
<h2>Total Orders</h2>
<p id="totalOrders">0</p>
</div>

<div class="card">
<h2>Total Revenue</h2>
<p>Â£<span id="totalRevenue">0.00</span></p>
</div>

<div class="card">
<h2>Funds Raised (Â£4000 Goal)</h2>
<p><span id="percentage">0</span>%</p>
<div class="progress-container">
<div class="progress-bar" id="progressBar"></div>
</div>
</div>
</div>

<div class="controls">
<input type="text" id="searchInput" placeholder="Search by order name...">
<select id="statusFilter">
<option value="all">All Statuses</option>
<option value="paid">Paid</option>
<option value="unpaid">Unpaid</option>
<option value="completed">Completed</option>
</select>
<button onclick="exportToExcel()">Export to Excel</button>
</div>

<table>
<thead>
<tr>
<th>Code</th>
<th>Name</th>
<th>Badges</th>
<th>Extra (Â£)</th>
<th>Total (Â£)</th>
<th>Paid</th>
<th>Collection</th>
<th>Completion</th>
<th>Delete</th>
</tr>
</thead>
<tbody id="orderTable"></tbody>
</table>

<div class="form-section">
<h2>Add New Order</h2>
<input type="text" id="newName" placeholder="Order Name">
<input type="number" id="newBadges" placeholder="Number of Badges">
<input type="number" step="0.01" id="newExtra" placeholder="Additional Payment (Â£)">
<button onclick="addOrder()">Add Order</button>
</div>

<div class="chart-section">
<h2>Monthly Revenue</h2>
<canvas id="revenueChart"></canvas>
</div>

<script>
const goal = 4000;
const monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

let orders = JSON.parse(localStorage.getItem("orders")) || [];

function saveData(){
localStorage.setItem("orders",JSON.stringify(orders));
}

function generateCode(){
return "ORD-"+Math.floor(10000+Math.random()*90000);
}

function calculateTotal(badges,extra){
return (badges*0.5)+extra;
}

function calculateMonthlyTotals(){
let totals={};
orders.forEach(o=>{
const month=monthNames[new Date().getMonth()];
totals[month]=(totals[month]||0)+o.total;
});
return totals;
}

function updateDashboard(){
const totalRevenue = orders.reduce((s,o)=>s+o.total,0);
const paidRevenue = orders.filter(o=>o.paid).reduce((s,o)=>s+o.total,0);
const unpaidRevenue = totalRevenue-paidRevenue;

const percent = Math.min((totalRevenue/goal)*100,100);

document.getElementById("totalOrders").innerText=orders.length;
document.getElementById("totalRevenue").innerText=totalRevenue.toFixed(2);
document.getElementById("percentage").innerText=percent.toFixed(1);
document.getElementById("progressBar").style.width=percent+"%";

return {totalRevenue,paidRevenue,unpaidRevenue};
}

function renderOrders(){
const table=document.getElementById("orderTable");
table.innerHTML="";

const search=document.getElementById("searchInput").value.toLowerCase();
const filter=document.getElementById("statusFilter").value;

orders.forEach(order=>{
let show=true;
if(!order.name.toLowerCase().includes(search)) show=false;
if(filter==="paid"&&!order.paid) show=false;
if(filter==="unpaid"&&order.paid) show=false;
if(filter==="completed"&&!order.completionDate) show=false;

if(show){
table.innerHTML+=`
<tr>
<td>${order.code}</td>
<td>${order.name}</td>
<td>${order.badges}</td>
<td>Â£${order.extra.toFixed(2)}</td>
<td>Â£${order.total.toFixed(2)}</td>
<td><input type="checkbox" ${order.paid?"checked":""} onchange="togglePaid('${order.code}')"></td>
<td><input type="date" value="${order.collectionDate||''}" onchange="updateDate('${order.code}','collectionDate',this.value)"></td>
<td><input type="date" value="${order.completionDate||''}" onchange="updateDate('${order.code}','completionDate',this.value)"></td>
<td><button class="delete-btn" onclick="deleteOrder('${order.code}')">ðŸ—‘</button></td>
</tr>`;
}
});

updateDashboard();
updateChart();
}

function addOrder(){
const name=document.getElementById("newName").value;
const badges=parseInt(document.getElementById("newBadges").value);
const extra=parseFloat(document.getElementById("newExtra").value)||0;

if(!name||!badges) return alert("Enter name and badge amount.");

const total=calculateTotal(badges,extra);

orders.push({
code:generateCode(),
name,
badges,
extra,
total,
paid:false,
collectionDate:"",
completionDate:""
});

saveData();
document.getElementById("newName").value="";
document.getElementById("newBadges").value="";
document.getElementById("newExtra").value="";
renderOrders();
}

function togglePaid(code){
const order=orders.find(o=>o.code===code);
order.paid=!order.paid;
saveData();
renderOrders();
}

function updateDate(code,field,value){
const order=orders.find(o=>o.code===code);
order[field]=value;
saveData();
}

function deleteOrder(code){
const order=orders.find(o=>o.code===code);
if(!order) return;

const confirmDelete = confirm(`Are you sure you want to delete order "${order.name}"?`);
if(!confirmDelete) return;

orders = orders.filter(o=>o.code!==code);
saveData();
renderOrders();
}

const ctx=document.getElementById("revenueChart").getContext("2d");
let revenueChart=new Chart(ctx,{
type:'bar',
data:{labels:[],datasets:[{label:'Revenue (Â£)',data:[]}]},
options:{responsive:true}
});

function updateChart(){
const totals=calculateMonthlyTotals();
revenueChart.data.labels=Object.keys(totals);
revenueChart.data.datasets[0].data=Object.values(totals);
revenueChart.update();
}

function exportToExcel(){
if(orders.length===0) return alert("No orders to export.");

const exportOrders=orders.map(o=>({
"Order Code":o.code,
"Name":o.name,
"Badges":o.badges,
"Extra (Â£)":o.extra.toFixed(2),
"Total (Â£)":o.total.toFixed(2),
"Paid":o.paid?"Yes":"No",
"Collection Date":o.collectionDate||"",
"Completion Date":o.completionDate||""
}));

const summary=updateDashboard();
const summarySheet=[
["Total Orders",orders.length],
["Total Revenue (Â£)",summary.totalRevenue.toFixed(2)],
["Paid Revenue (Â£)",summary.paidRevenue.toFixed(2)],
["Unpaid Revenue (Â£)",summary.unpaidRevenue.toFixed(2)],
["Goal (Â£)",goal],
["% of Goal",(summary.totalRevenue/goal*100).toFixed(1)+"%"]
];

const monthlySheet=Object.entries(calculateMonthlyTotals())
.map(([m,v])=>({Month:m,"Revenue (Â£)":v.toFixed(2)}));

const wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(exportOrders),"Orders");
XLSX.utils.book_append_sheet(wb,XLSX.utils.aoa_to_sheet(summarySheet),"Summary");
XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(monthlySheet),"Monthly Revenue");

const today=new Date().toISOString().split("T")[0];
XLSX.writeFile(wb,`orders_export_${today}.xlsx`);
}

document.getElementById("searchInput").addEventListener("input",renderOrders);
document.getElementById("statusFilter").addEventListener("change",renderOrders);

renderOrders();
</script>

</body>
</html>
